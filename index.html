<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BPSR Assist Mobileï¼š50å±¤åˆ¶é™ï¼†Ultimateæº–å‚™ç‰ˆ</title>
    <!-- æ¥½ã—ã„é›°å›²æ°—ã‚’å‡ºã™ãŸã‚ã®ä¸¸æ–‡å­—ãƒ•ã‚©ãƒ³ãƒˆ -->
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            font-family: 'M PLUS Rounded 1c', sans-serif;
        }

        /* ã‚¿ãƒƒãƒ—æ™‚ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’æŠ‘åˆ¶ */
        * { -webkit-tap-highlight-color: transparent; }
        
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track { background: #1c1917; }
        ::-webkit-scrollbar-thumb {
            background: #44403c; 
            border-radius: 10px;
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            height: 250px;
        }
        @media (min-width: 768px) {
            .chart-container { height: 320px; }
        }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ãƒ–ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .tab-active {
            border-bottom: 5px solid #f97316;
            color: #ffffff !important;
            font-weight: 800;
            background-color: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }
        
        /* ãŠç¥ã„ã®ãƒã‚³ãƒã‚³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ–°ã—ãé”æˆã—ãŸã¨ãã®ã¿ï¼‰ */
        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.08); }
            100% { transform: scale(1); }
        }
        .animate-pop {
            animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }

        /* ã‚«ã‚¹ã‚¿ãƒ ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ */
        .custom-check {
            appearance: none;
            width: 1.6rem;
            height: 1.6rem;
            border: 3px solid #d6d3d1;
            border-radius: 0.5rem;
            background-color: white;
            display: inline-grid;
            place-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .custom-check:checked {
            background-color: #f97316;
            border-color: #fb923c;
        }
        .custom-check:checked::before {
            content: "âœ”";
            color: white;
            font-size: 1rem;
            font-weight: bold;
        }
        .custom-check:disabled {
            background-color: #e5e7eb;
            border-color: #d1d5db;
            cursor: not-allowed;
            opacity: 0.5;
        }

        /* éºè·¡ã®ãƒ•ãƒ­ã‚¢ãƒœã‚¿ãƒ³ */
        .floor-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: 800;
            border-radius: 0.75rem;
            transition: all 0.2s;
            padding: 0.75rem 0.25rem;
        }
        .floor-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            background-color: #44403c !important;
            color: #78716c !important;
        }
    </style>
</head>
<body class="bg-stone-950 text-stone-100 font-sans min-h-screen flex flex-col pb-10">

    <header class="bg-stone-900 shadow-lg border-b border-stone-800 sticky top-0 z-20">
        <div class="max-w-4xl mx-auto px-4 py-4 flex justify-between items-center">
            <div>
                <h1 class="text-xl md:text-3xl font-extrabold text-white tracking-tight flex items-center">
                    BPSR Assist <span class="text-orange-500 ml-2">Mobile</span>
                </h1>
                <p class="text-[10px] md:text-sm text-stone-400 font-bold">ã‚¹ã‚¿ãƒ¬ã‚¾ã®æ´»å‹•ã‚’ã‚¹ãƒãƒ¼ãƒˆã«è¨˜éŒ²</p>
            </div>
            <button onclick="toggleHelp()" class="bg-stone-800 text-stone-300 w-10 h-10 rounded-full flex items-center justify-center text-xl shadow-inner border border-stone-700">
                â“
            </button>
        </div>
    </header>

    <!-- Help Overlay -->
    <div id="help-overlay" class="fixed inset-0 bg-stone-950/90 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-stone-900 rounded-3xl max-w-sm w-full p-8 shadow-2xl border border-stone-700 animate-fade-in">
            <h3 class="font-extrabold text-2xl mb-4 text-white">éºè·¡ï¼†ãƒ¬ã‚¤ãƒ‰ã®çŠ¶æ³</h3>
            <ul class="text-sm space-y-4 text-stone-300 mb-8 font-bold">
                <li class="flex items-start"><span class="text-orange-500 mr-2 text-lg">ğŸ—¿</span><span>**ãƒ¬ã‚°ãƒ‡ã‚£ãƒ‹ã‚¹**: ç¾åœ¨ã¯50å±¤ã¾ã§ã‚¯ãƒªã‚¢å¯èƒ½ï¼51å±¤ä»¥é™ã¯æº–å‚™ä¸­ã§ã™ã€‚</span></li>
                <li class="flex items-start"><span class="text-orange-500 mr-2 text-lg">ğŸ‰</span><span>**æµ®å³¶ãƒ¬ã‚¤ãƒ‰**: ã‚¢ãƒ«ãƒ†ã‚£ãƒ¡ãƒƒãƒˆé›£æ˜“åº¦ãŒè¿½åŠ ï¼ˆè¿‘æ—¥å…¬é–‹äºˆå®šï¼‰ï¼</span></li>
                <li class="flex items-start"><span class="text-orange-500 mr-2 text-lg">âœ¨</span><span>é”æˆã—ãŸç¬é–“ã€ãƒã‚³ãƒƒã¨å¼¾ã‘ã‚‹ãŠç¥ã„æ¼”å‡ºä»˜ãã€‚</span></li>
            </ul>
            <button onclick="toggleHelp()" class="w-full bg-orange-600 hover:bg-orange-500 text-white py-4 rounded-2xl font-black text-lg shadow-lg">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <main class="flex-grow container mx-auto px-4 py-4 max-w-4xl space-y-6">

        <!-- Progress Overview -->
        <section class="bg-stone-900 rounded-3xl shadow-sm p-4 border border-stone-800 overflow-hidden">
            <div class="flex flex-col md:flex-row gap-6 items-center">
                <div class="w-full md:w-1/2">
                    <div class="chart-container">
                        <canvas id="progressRadar"></canvas>
                    </div>
                </div>

                <div class="w-full md:w-1/2 grid grid-cols-1 gap-4">
                    <div class="bg-stone-950/50 p-4 rounded-2xl border border-stone-800 shadow-inner">
                        <div class="flex justify-between text-xs font-black mb-1 tracking-wider uppercase">
                            <span class="text-stone-400">DAILY PROGRESS</span>
                            <span id="daily-text" class="text-orange-500 text-lg">0%</span>
                        </div>
                        <div class="w-full bg-stone-800 rounded-full h-3">
                            <div id="daily-bar" class="bg-orange-500 h-3 rounded-full transition-all duration-700" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="bg-stone-950/50 p-4 rounded-2xl border border-stone-800 shadow-inner">
                        <div class="flex justify-between text-xs font-black mb-1 tracking-wider uppercase">
                            <span class="text-stone-400">WEEKLY PROGRESS</span>
                            <span id="weekly-text" class="text-stone-300 text-lg">0%</span>
                        </div>
                        <div class="w-full bg-stone-800 rounded-full h-3">
                            <div id="weekly-bar" class="bg-stone-300 h-3 rounded-full transition-all duration-700" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="bg-stone-950/50 p-4 rounded-2xl border border-stone-800 shadow-inner">
                        <div class="flex justify-between text-xs font-black mb-1 tracking-wider uppercase">
                            <span class="text-stone-400">MATERIALS SUBMISSION</span>
                            <span id="material-text" class="text-amber-500 text-lg">0%</span>
                        </div>
                        <div class="w-full bg-stone-800 rounded-full h-3">
                            <div id="material-bar" class="bg-amber-500 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Navigation Tabs -->
        <nav class="flex bg-stone-800 rounded-2xl shadow-xl border border-stone-700 overflow-hidden sticky top-[76px] z-10 p-1">
            <button onclick="switchTab('daily')" id="tab-daily" class="flex-1 py-4 text-center text-lg font-black transition-all text-stone-400 rounded-xl">
                æ—¥èª²
            </button>
            <button onclick="switchTab('weekly')" id="tab-weekly" class="flex-1 py-4 text-center text-lg font-black transition-all text-stone-400 rounded-xl">
                é€±èª²
            </button>
            <button onclick="switchTab('materials')" id="tab-materials" class="flex-1 py-4 text-center text-lg font-black transition-all text-stone-400 rounded-xl">
                ç‰©è³‡
            </button>
        </nav>

        <div id="content-area" class="pb-10"></div>
    </main>

    <script>
        const dailyData = [
            { id: 'd_guild_att', label: 'ã‚®ãƒ«ãƒ‰ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³', desc: 'ã‚®ãƒ«ãƒ‰EXPãƒ»ã‚®ãƒ«ãƒ‰è³‡é‡‘ãƒ»ã‚®ãƒ«ãƒ‰æ´»èºåº¦', category: 'Lifestyle', icon: 'ğŸ¢' },
            { id: 'd_guild_trans', label: 'ã‚®ãƒ«ãƒ‰è¼¸é€', desc: 'ã‚®ãƒ«ãƒ‰ã‚³ã‚¤ãƒ³ãƒ»ãƒ«ãƒ¼ãƒãƒ»å®ç®±ãªã©', category: 'Economy', icon: 'ğŸšš' },
            { id: 'd_shop_myst', label: 'ç¥ç§˜ã‚¹ãƒˆã‚¢', desc: 'æœ€ä¸Šç´šç´ æBOXãƒ»ãƒ©ãƒ³ã‚¯ã‚¢ãƒƒãƒ—ã®æ›¸ãƒ»å„ªå¾…ãƒ»ç®±ãƒ»çµæ™¶', category: 'Economy', icon: 'ğŸ›’' },
            { id: 'd_pioneer_req', label: 'é–‹æ‹“å±€ä¾é ¼', desc: 'ãƒ«ãƒ¼ãƒãƒ»åå£°ãƒ»GCãƒ»ãƒ¡ãƒ€ãƒ«', category: 'Lifestyle', icon: 'ğŸ“œ' },
            { id: 'd_boss_hunt', label: 'ãƒœã‚¹è¨ä¼', desc: 'éµæ¶ˆåŒ–ãƒ»ã‚¦ã‚£ãƒ«å›å', category: 'Battle', icon: 'ğŸ‘¹' },
            { id: 'd_elite_hunt', label: 'ç²¾é‹­è¨ä¼', desc: 'éµæ¶ˆåŒ–ãƒ»ã‚¦ã‚£ãƒ«å›å', category: 'Battle', icon: 'ğŸ›¡ï¸' },
            { id: 'd_home_req', label: 'ãƒ›ãƒ¼ãƒ ä¾é ¼', desc: 'ãƒ¬ã‚¢ç´ æãƒ»ãƒ›ãƒ¼ãƒ EXPãƒ»ãƒ›ãƒ¼ãƒ ã‚³ã‚¤ãƒ³ãƒ»ãƒ›ãƒ¼ãƒ è‚¥æ–™', category: 'Lifestyle', icon: 'ğŸ ' },
            { id: 'd_flower', label: 'èŠ±ã®æ ½åŸ¹', desc: 'æ°´ã‚„ã‚Šãƒ»åç©«', category: 'Lifestyle', icon: 'ğŸŒ»' },
            { id: 'd_alch_exp', label: 'éŒ¬é‡‘å®Ÿé¨“', desc: '10EXPÃ—5ãƒ»ç©å…·èŠ±ç«', category: 'Lifestyle', icon: 'âš—ï¸' },
            { id: 'd_unstable', label: 'ä¸å®‰å®šãªç©ºé–“', desc: 'è£…å‚™ãƒ»å¼·åŒ–ç´ æ', category: 'Battle', icon: 'âš”ï¸' },
            { id: 'd_season', label: 'ã‚·ãƒ¼ã‚ºãƒ³æ´»èºåº¦', desc: 'EXPãƒ»GCãƒ»ãƒ«ãƒ¼ãƒãƒ»ã‚·ãƒ¼ã‚ºãƒ³Pãªã©', category: 'Economy', icon: 'ğŸ' },
            { id: 'd_focus', label: 'ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ¶ˆè²»', desc: '400/æ—¥ãƒ»ä¸Šé™2000', category: 'Lifestyle', icon: 'âš¡' },
            { id: 'd_raid', label: 'ãƒ¯ãƒ¼ãƒ«ãƒ‰ãƒ¬ã‚¤ãƒ‰', desc: '20:30ã€œ22:00é–‹å‚¬', category: 'Battle', icon: 'â°' },
            { id: 'd_guild_hunt', label: 'ã‚®ãƒ«ãƒ‰ãƒãƒ³ãƒˆ', desc: 'é‡‘ã€œæ—¥ 10:00ï½24:00ï¼šã‚®ãƒ«ãƒ‰è²¢çŒ®åº¦ãƒ»ç´ æ', category: 'Battle', icon: 'ğŸ¹', schedule: [5, 6, 0] },
            { id: 'd_guild_dance', label: 'ã‚®ãƒ«ãƒ‰ãƒ€ãƒ³ã‚¹', desc: 'é‡‘ 19:30ï½19:55ï¼šã‚®ãƒ«ãƒ‰è²¢çŒ®åº¦ãƒ»EXP', category: 'Lifestyle', icon: 'ğŸ’ƒ', schedule: [5] }
        ];

        const weeklyData = [
            { id: 'w_shop_colorful', label: 'ã‚«ãƒ©ãƒ•ãƒ«ã‚¹ãƒˆã‚¢', desc: 'ã‚¸ã‚§ãƒ ãƒ»å‹æƒ…ãƒ»GCãƒ»åå£°ã®å„é …ç›®ã‚’ç¢ºèª', category: 'Economy', icon: 'ğŸ’', isColorfulStore: true },
            { id: 'w_shop_season', label: 'ã‚·ãƒ¼ã‚ºãƒ³ã‚¹ãƒˆã‚¢', desc: 'ä¸Šç´šç´ æãƒ»è™šè•ãƒ»ãƒ‘ãƒ¯ãƒ¼ãƒ‘ãƒ¼ãƒ„', category: 'Economy', icon: 'ğŸ‚' },
            { id: 'w_shop_guild', label: 'ã‚®ãƒ«ãƒ‰é›‘è²¨å±‹', desc: 'ãƒ•ã‚©ãƒ¼ã‚«ã‚¹å›å¾©å‰¤è³¼å…¥', category: 'Economy', icon: 'ğŸšï¸' },
            { id: 'w_module', label: 'ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«', desc: 'åˆ†è§£ãƒ»äº¤æ›', category: 'Economy', icon: 'âš™ï¸' },
            { id: 'w_pioneer', label: 'é–‹æ‹“è€…è¤’ç« ', desc: 'æœˆæ›œå—å–', category: 'Economy', icon: 'ğŸ›ï¸' },
            { id: 'w_guild_act', label: 'ã‚®ãƒ«ãƒ‰é€±é–“æ´»èºåº¦å ±é…¬', desc: 'ã‚¢ã‚¤ãƒ†ãƒ å ±é…¬ãƒ»æ´»èºåº¦ç¢ºèª', category: 'Lifestyle', icon: 'ğŸ“Š' },
            { id: 'w_floating_raid', label: 'æµ®å³¶ãƒ¬ã‚¤ãƒ‰(ç¥ç«œã®æ·)', desc: 'å…¨ç«œ Easy & Hard åˆ¶è¦‡', category: 'Battle', icon: 'ğŸ‰', isComplex: true },
            { id: 'w_regdinis', label: 'ãƒ¬ã‚°ãƒ‡ã‚£ãƒ‹ã‚¹éºè·¡', desc: 'ã‚¿ãƒ¯ãƒ¼æ”»ç•¥çŠ¶æ³', category: 'Battle', icon: 'ğŸ—¿', isRuins: true },
        ];

        const materialData = [
            { id: 'm_wood', type: 'æœ¨å·¥', req: 'æ¾æãƒ»40', category: 'Economy' },
            { id: 'm_cryst', type: 'çµæ™¶å­¦', req: 'ç²˜åœŸ80ãƒ»ç´°ç ‚80ãƒ»æ¸…ã‚‰ã‹ãªæ¹§æ°´80ãƒ»å²©å¡©80', category: 'Economy' },
            { id: 'm_botany', type: 'æ¤ç‰©å­¦', req: 'å¹²ã—è‰80ãƒ»é…¸ã£ã±ã„æœå®Ÿæ¶²ä½“80ãƒ»åŸºè³ªåœŸ80ãƒ»æ¨¹è„‚80', category: 'Economy' },
            { id: 'm_alch', type: 'éŒ¬é‡‘', req: 'è¬ã®çŸ³ã®ç²‰ãƒ»40', category: 'Economy' },
            { id: 'm_forge', type: 'é›é€ ', req: 'é‰„ã‚¤ãƒ³ã‚´ãƒƒãƒˆãƒ»40', category: 'Economy' },
            { id: 'm_textile', type: 'ç¹”ç‰©', req: 'æ”¹è‰¯ç¶¿å¸ƒãƒ»20', category: 'Economy' },
            { id: 'm_craft', type: 'å·¥èŠ¸', req: 'ç ‚å²©ã®ç ¥çŸ³ãƒ»40', category: 'Economy' },
            { id: 'm_cook', type: 'æ–™ç†', req: 'å°éº¦ç²‰ãƒ»45', category: 'Economy' },
            { id: 'm_mineral', type: 'é‰±ç‰©å­¦', req: 'ç²˜åœŸ80ãƒ»ç´°ç ‚80ãƒ»æ¸…ã‚‰ã‹ãªæ¹§ãæ°´80ãƒ»é‡‘å±ç ‚80', category: 'Economy' },
        ];

        // --- STATE ---
        const savedState = JSON.parse(localStorage.getItem('sr_assist_mobile_v5')) || {
            checked: {},
            lastDailyReset: 0,
            lastWeeklyReset: 0,
            regdinisFloor: 0
        };

        let state = {
            checked: savedState.checked || {},
            lastDailyReset: savedState.lastDailyReset || 0,
            lastWeeklyReset: savedState.lastWeeklyReset || 0,
            regdinisFloor: savedState.regdinisFloor || 0,
            activeTab: 'daily',
            lastClickedId: null 
        };

        let myChart = null;

        // --- UTILS ---
        function save() {
            const dataToSave = {
                checked: state.checked,
                lastDailyReset: state.lastDailyReset,
                lastWeeklyReset: state.lastWeeklyReset,
                regdinisFloor: state.regdinisFloor
            };
            localStorage.setItem('sr_assist_mobile_v5', JSON.stringify(dataToSave));
        }

        function getLatestDailyDeadline(now) {
            const deadline = new Date(now);
            deadline.setHours(5, 0, 0, 0);
            if (now < deadline) deadline.setDate(deadline.getDate() - 1);
            return deadline.getTime();
        }

        function getLatestWeeklyDeadline(now) {
            const deadline = new Date(now);
            deadline.setHours(5, 0, 0, 0);
            let day = deadline.getDay();
            let diff = (day === 0) ? 6 : day - 1; 
            deadline.setDate(deadline.getDate() - diff);
            if (now < deadline) deadline.setDate(deadline.getDate() - 7);
            return deadline.getTime();
        }

        function autoResetCheck() {
            const now = Date.now();
            const dailyDeadline = getLatestDailyDeadline(now);
            const weeklyDeadline = getLatestWeeklyDeadline(now);
            let changed = false;

            if (state.lastDailyReset < dailyDeadline) {
                Object.keys(state.checked).forEach(key => {
                    if (key.startsWith('d_')) delete state.checked[key];
                });
                state.lastDailyReset = now;
                changed = true;
            }

            if (state.lastWeeklyReset < weeklyDeadline) {
                Object.keys(state.checked).forEach(key => {
                    if (key.startsWith('w_') || key.startsWith('m_')) delete state.checked[key];
                });
                state.regdinisFloor = 0;
                state.lastWeeklyReset = now;
                changed = true;
            }

            if (changed) save();
        }

        function getVisibleDailyTasks() {
            const today = new Date().getDay();
            return dailyData.filter(task => !task.schedule || task.schedule.includes(today));
        }

        // --- CORE LOGIC ---
        document.addEventListener('DOMContentLoaded', () => {
            autoResetCheck();
            initChart();
            switchTab('daily');
        });

        function toggleHelp() {
            document.getElementById('help-overlay').classList.toggle('hidden');
        }

        function toggleTask(id) {
            state.lastClickedId = id;
            if (state.checked[id]) {
                delete state.checked[id];
                state.lastClickedId = null;
            } else {
                state.checked[id] = true;
            }
            save();
            updateUI();
        }

        function toggleSubRaid(subId) {
            const fullId = `w_raid_${subId}`;
            state.lastClickedId = fullId;
            if (state.checked[fullId]) {
                delete state.checked[fullId];
                state.lastClickedId = null;
            } else {
                state.checked[fullId] = true;
            }
            
            const dragons = ['ice', 'dark', 'light'];
            const allCleared = dragons.every(d => state.checked[`w_raid_${d}_easy`] && state.checked[`w_raid_${d}_hard`]);
            
            if (allCleared) {
                if (!state.checked['w_floating_raid']) state.lastClickedId = 'w_floating_raid';
                state.checked['w_floating_raid'] = true;
            } else {
                delete state.checked['w_floating_raid'];
            }
            
            save();
            updateUI();
        }

        function toggleSubStore(subId) {
            const fullId = `w_shop_${subId}`;
            state.lastClickedId = fullId;
            if (state.checked[fullId]) {
                delete state.checked[fullId];
                state.lastClickedId = null;
            } else {
                state.checked[fullId] = true;
            }
            
            const subs = ['gem', 'friend', 'gc', 'fame'];
            const allCleared = subs.every(s => state.checked[`w_shop_${s}`]);
            
            if (allCleared) {
                if (!state.checked['w_shop_colorful']) state.lastClickedId = 'w_shop_colorful';
                state.checked['w_shop_colorful'] = true;
            } else {
                delete state.checked['w_shop_colorful'];
            }
            
            save();
            updateUI();
        }

        function setRegdinisFloor(floor) {
            if (floor > 50) return; 

            if (state.regdinisFloor === floor) {
                state.regdinisFloor = Math.max(0, floor - 5);
            } else {
                state.regdinisFloor = floor;
            }
            
            state.lastClickedId = 'w_regdinis';
            if (state.regdinisFloor >= 50) state.checked['w_regdinis'] = true;
            else delete state.checked['w_regdinis'];
            save();
            updateUI();
        }

        function resetCategory() {
            state.lastClickedId = null;
            if (state.activeTab === 'daily') {
                getVisibleDailyTasks().forEach(t => delete state.checked[t.id]);
            } else if (state.activeTab === 'weekly') {
                weeklyData.forEach(t => {
                    delete state.checked[t.id];
                    if (t.isComplex) {
                        ['ice', 'dark', 'light'].forEach(d => {
                            delete state.checked[`w_raid_${d}_easy`];
                            delete state.checked[`w_raid_${d}_hard`];
                            delete state.checked[`w_raid_${d}_ultimate`];
                        });
                    }
                    if (t.isColorfulStore) {
                        ['gem', 'friend', 'gc', 'fame'].forEach(s => delete state.checked[`w_shop_${s}`]);
                    }
                });
                state.regdinisFloor = 0;
            } else {
                materialData.forEach(t => delete state.checked[t.id]);
            }
            save();
            updateUI();
        }

        function updateUI() {
            const visibleDaily = getVisibleDailyTasks();
            const d = getStats(visibleDaily);
            const w = getStats(weeklyData);
            const m = getStats(materialData);

            document.getElementById('daily-text').innerText = `${d.pct}%`;
            document.getElementById('daily-bar').style.width = `${d.pct}%`;
            document.getElementById('weekly-text').innerText = `${w.pct}%`;
            document.getElementById('weekly-bar').style.width = `${w.pct}%`;
            document.getElementById('material-text').innerText = `${m.pct}%`;
            document.getElementById('material-bar').style.width = `${m.pct}%`;

            if (myChart) {
                myChart.data.datasets[0].data = getRadarValues();
                myChart.update();
            }
            renderList();
        }

        function getStats(data) {
            const done = data.filter(item => {
                if (item.isRuins) return state.regdinisFloor >= 50;
                return state.checked[item.id];
            }).length;
            return { pct: data.length ? Math.round((done / data.length) * 100) : 0 };
        }

        function getRadarValues() {
            let scores = { Battle: {d:0,t:0}, Lifestyle: {d:0,t:0}, Economy: {d:0,t:0} };
            const visibleDaily = getVisibleDailyTasks();
            const all = [...visibleDaily, ...weeklyData, ...materialData];
            all.forEach(item => {
                scores[item.category].t++;
                if (item.isRuins) {
                    if (state.regdinisFloor >= 50) scores[item.category].d++;
                } else {
                    if (state.checked[item.id]) scores[item.category].d++;
                }
            });
            return [
                scores.Battle.t ? (scores.Battle.d / scores.Battle.t) * 100 : 0,
                scores.Lifestyle.t ? (scores.Lifestyle.d / scores.Lifestyle.t) * 100 : 0,
                scores.Economy.t ? (scores.Economy.d / scores.Economy.t) * 100 : 0
            ];
        }

        function initChart() {
            const ctx = document.getElementById('progressRadar').getContext('2d');
            myChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['ãƒãƒˆãƒ«', 'ç”Ÿæ´»', 'çµŒæ¸ˆ'],
                    datasets: [{
                        data: [0, 0, 0],
                        backgroundColor: 'rgba(249, 115, 22, 0.35)',
                        borderColor: 'rgb(249, 115, 22)',
                        borderWidth: 3,
                        pointRadius: 5,
                        pointBackgroundColor: 'rgb(249, 115, 22)',
                        pointBorderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            suggestedMin: 0,
                            suggestedMax: 100,
                            ticks: { display: false, stepSize: 20 },
                            grid: { color: 'rgba(255, 255, 255, 0.2)' },
                            angleLines: { color: 'rgba(255, 255, 255, 0.2)' },
                            pointLabels: { 
                                font: { size: 14, weight: 'bold', family: "'M PLUS Rounded 1c'" },
                                color: '#d6d3d1' 
                            }
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function switchTab(name) {
            state.activeTab = name;
            state.lastClickedId = null;
            ['daily', 'weekly', 'materials'].forEach(t => {
                const btn = document.getElementById(`tab-${t}`);
                if (t === name) {
                    btn.classList.add('tab-active');
                    btn.classList.remove('text-stone-400');
                } else {
                    btn.classList.remove('tab-active');
                    btn.classList.add('text-stone-400');
                }
            });
            updateUI();
        }

        function renderList() {
            const container = document.getElementById('content-area');
            container.innerHTML = '';

            const header = document.createElement('div');
            header.className = 'flex justify-between items-center py-4 animate-fade-in';
            const days = ["æ—¥", "æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ"];
            const now = new Date();
            const dateStr = `${now.getMonth()+1}/${now.getDate()}(${days[now.getDay()]})`;

            header.innerHTML = `
                <span class="text-xs font-black text-stone-500 tracking-widest uppercase font-bold">
                    ${state.activeTab === 'daily' ? `Adventure Log [${dateStr}]` : (state.activeTab === 'weekly' ? 'Weekly Milestone' : 'Material Check')}
                </span>
                <button onclick="resetCategory()" class="text-[10px] font-black bg-stone-900 text-stone-500 px-4 py-2 rounded-full border border-stone-800 active:scale-95 transition-all">
                    RELOAD LIST
                </button>
            `;
            container.appendChild(header);

            const list = document.createElement('div');
            list.className = 'space-y-4 animate-fade-in';
            const data = state.activeTab === 'daily' ? getVisibleDailyTasks() : (state.activeTab === 'weekly' ? weeklyData : materialData);

            data.forEach(item => {
                const isChecked = state.checked[item.id] || (item.isRuins && state.regdinisFloor >= 50);
                const isNew = state.lastClickedId === item.id;

                if (item.isComplex) {
                    const card = document.createElement('div');
                    card.className = `flex flex-col p-5 rounded-3xl border transition-all shadow-xl ${isChecked ? 'bg-stone-800 border-transparent' : 'bg-white border-stone-200'} ${isNew ? 'animate-pop' : ''}`;
                    
                    let content = `
                        <div class="flex items-center mb-6">
                            <div class="w-14 h-14 rounded-2xl flex items-center justify-center text-3xl mr-5 border-4 ${isChecked ? 'bg-stone-700 border-stone-600' : 'bg-stone-100 border-stone-200'}">
                                ${item.icon}
                            </div>
                            <div class="flex-1 ${isChecked ? 'text-stone-200 opacity-60' : ''}">
                                <h4 class="text-lg font-black ${isChecked ? 'text-white' : 'text-stone-900'} font-bold">${item.label}</h4>
                                <p class="text-xs ${isChecked ? 'text-stone-300' : 'text-stone-500'} font-bold mt-1">${item.desc}</p>
                            </div>
                            <div class="w-10 h-10 rounded-xl border-4 flex items-center justify-center ${isChecked ? 'bg-orange-600 border-orange-500' : 'border-stone-200'}">
                                ${isChecked ? '<span class="text-white text-xl">âœ”</span>' : ''}
                            </div>
                        </div>
                        <div class="grid grid-cols-3 gap-2 mt-2">
                    `;

                    ['ice', 'dark', 'light'].forEach(dId => {
                        const dName = dId === 'ice' ? 'æ°·ç«œ' : dId === 'dark' ? 'é—‡ç«œ' : 'å…‰ç«œ';
                        const dragonCleared = state.checked[`w_raid_${dId}_easy`] && state.checked[`w_raid_${dId}_hard`];
                        const isDragonNew = state.lastClickedId === `w_raid_${dId}_easy` || state.lastClickedId === `w_raid_${dId}_hard`;

                        content += `
                            <div class="${dragonCleared ? 'bg-orange-100 border-orange-200' : 'bg-stone-50 border-stone-100'} p-2 rounded-2xl border flex flex-col items-center transition-all ${isDragonNew && dragonCleared ? 'animate-pop' : ''}">
                                <span class="text-sm font-black text-stone-900 mb-3">${dName}</span>
                                <div class="flex flex-col gap-3 w-full">
                                    <label class="flex items-center justify-between gap-1">
                                        <span class="text-[10px] font-bold text-stone-500">Easy</span>
                                        <input type="checkbox" class="custom-check" ${state.checked[`w_raid_${dId}_easy`] ? 'checked' : ''} onchange="toggleSubRaid('${dId}_easy')">
                                    </label>
                                    <label class="flex items-center justify-between gap-1">
                                        <span class="text-[10px] font-bold text-stone-500">Hard</span>
                                        <input type="checkbox" class="custom-check" ${state.checked[`w_raid_${dId}_hard`] ? 'checked' : ''} onchange="toggleSubRaid('${dId}_hard')">
                                    </label>
                                    <label class="flex items-center justify-between gap-1 opacity-40">
                                        <span class="text-[10px] font-bold text-stone-700">Ult</span>
                                        <div class="w-6 h-6 rounded flex items-center justify-center bg-stone-200 text-[10px] text-stone-500">ğŸ”’</div>
                                    </label>
                                </div>
                                ${dragonCleared ? '<div class="mt-2 text-[8px] text-orange-600 font-black animate-pop tracking-tighter">COMPLETEï¼</div>' : ''}
                            </div>
                        `;
                    });
                    content += `</div>`;
                    card.innerHTML = content;
                    list.appendChild(card);

                } else if (item.isColorfulStore) {
                    const card = document.createElement('div');
                    card.className = `flex flex-col p-5 rounded-3xl border transition-all shadow-xl ${isChecked ? 'bg-stone-800 border-transparent' : 'bg-white border-stone-200'} ${isNew ? 'animate-pop' : ''}`;
                    
                    let content = `
                        <div class="flex items-center mb-6">
                            <div class="w-14 h-14 rounded-2xl flex items-center justify-center text-3xl mr-5 border-4 ${isChecked ? 'bg-stone-700 border-stone-600' : 'bg-stone-100 border-stone-200'}">
                                ${item.icon}
                            </div>
                            <div class="flex-1 ${isChecked ? 'text-stone-200 opacity-60' : ''}">
                                <h4 class="text-lg font-black ${isChecked ? 'text-white' : 'text-stone-900'} font-bold">${item.label}</h4>
                                <p class="text-xs ${isChecked ? 'text-stone-300' : 'text-stone-500'} font-bold mt-1">${item.desc}</p>
                            </div>
                            <div class="w-10 h-10 rounded-xl border-4 flex items-center justify-center ${isChecked ? 'bg-orange-600 border-orange-500' : 'border-stone-200'}">
                                ${isChecked ? '<span class="text-white text-xl">âœ”</span>' : ''}
                            </div>
                        </div>
                        <div class="flex flex-col gap-3">
                    `;

                    const subStores = [
                        { id: 'gem', label: 'ãƒ­ãƒ¼ã‚ºã‚¸ã‚§ãƒ ', desc: 'ã‚¬ãƒãƒ£ã‚³ã‚¤ãƒ³' },
                        { id: 'friend', label: 'å‹æƒ…ãƒã‚¤ãƒ³ãƒˆ', desc: 'ã‚¸ã‚§ãƒ ' },
                        { id: 'gc', label: 'GC', desc: 'å¾¡åº§é‡‘ãƒ»ãƒ«ãƒ¼ãƒ³åˆé‡‘ãƒ»æ¬ ç‰‡ãƒ»çµæ™¶ãƒ»æ”¹é‹³çŸ³ãƒ»ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ»å¥¥ç¾©ãƒ»ãƒ©ãƒ³ã‚¯ã‚¢ãƒƒãƒ—' },
                        { id: 'fame', label: 'åå£°', desc: 'ã‚¦ã‚£ãƒ«ã‚³ã‚¤ãƒ³' }
                    ];

                    subStores.forEach(s => {
                        const subChecked = state.checked[`w_shop_${s.id}`];
                        const isSubNew = state.lastClickedId === `w_shop_${s.id}`;
                        content += `
                            <div onclick="toggleSubStore('${s.id}'); event.stopPropagation();" 
                                class="${subChecked ? 'bg-orange-50 border-orange-100' : 'bg-stone-50 border-stone-100'} p-3 rounded-2xl border flex items-center transition-all ${isSubNew && subChecked ? 'animate-pop' : ''}">
                                <input type="checkbox" class="custom-check mr-4" ${subChecked ? 'checked' : ''} onclick="event.stopPropagation();" onchange="toggleSubStore('${s.id}')">
                                <div class="flex-1">
                                    <span class="text-sm font-black text-stone-900 ${subChecked ? 'line-through opacity-40' : ''}">${s.label}</span>
                                    <p class="text-[10px] text-stone-500 font-bold leading-tight ${subChecked ? 'opacity-30' : ''}">${s.desc}</p>
                                </div>
                                ${subChecked ? '<span class="text-orange-500 font-black text-[10px] ml-2">OKï¼</span>' : ''}
                            </div>
                        `;
                    });
                    content += `</div>`;
                    card.innerHTML = content;
                    list.appendChild(card);

                } else if (item.isRuins) {
                    const card = document.createElement('div');
                    card.className = `flex flex-col p-5 rounded-3xl border shadow-xl transition-all ${isChecked ? 'bg-stone-800 border-transparent' : 'bg-white border-stone-200'} ${isNew ? 'animate-pop' : ''}`;
                    
                    let gridHtml = `<div class="grid grid-cols-1 gap-3 mt-6">`;
                    for (let i = 0; i < 60; i += 5) {
                        const start = i + 1;
                        const end = i + 4;
                        const boss = i + 5;
                        
                        const isPreparation = boss > 50; 
                        const rangeDone = state.regdinisFloor >= end;
                        const bossDone = state.regdinisFloor >= boss;

                        gridHtml += `
                            <div class="flex gap-2">
                                <button onclick="setRegdinisFloor(${end})" ${isPreparation ? 'disabled' : ''}
                                    class="floor-btn flex-1 ${rangeDone ? 'bg-orange-500 text-white shadow-md' : 'bg-stone-100 text-stone-500'}">
                                    ${start}-${end}
                                </button>
                                <button onclick="setRegdinisFloor(${boss})" ${isPreparation ? 'disabled' : ''}
                                    class="floor-btn w-20 ${bossDone ? 'bg-orange-600 text-white shadow-md' : 'bg-stone-200 text-stone-700'} border-2 ${bossDone ? 'border-orange-400' : 'border-stone-300'}">
                                    ${boss} <span class="ml-1 text-[10px]">${bossDone ? 'ğŸ‘‘' : (isPreparation ? 'ğŸš§' : '')}</span>
                                </button>
                            </div>
                        `;
                    }
                    gridHtml += `</div>`;

                    card.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="w-14 h-14 rounded-2xl flex items-center justify-center text-3xl mr-5 border-4 ${isChecked ? 'bg-stone-700 border-stone-600' : 'bg-stone-100 border-stone-200'}">
                                    ${item.icon}
                                </div>
                                <div>
                                    <h4 class="text-lg font-black ${isChecked ? 'text-white' : 'text-stone-900'} font-bold">${item.label}</h4>
                                    <p class="text-xs ${isChecked ? 'text-stone-300' : 'text-stone-500'} font-bold mt-1">æœ€é«˜ï¼š${state.regdinisFloor}å±¤ã‚¯ãƒªã‚¢ï¼ˆ50å±¤ã¾ã§å®Ÿè£…ä¸­ï¼‰</p>
                                </div>
                            </div>
                            <div class="text-right">
                                ${isChecked ? '<span class="text-orange-500 font-black text-lg animate-pop">COMPLETEï¼</span>' : ''}
                            </div>
                        </div>
                        ${gridHtml}
                    `;
                    list.appendChild(card);

                } else if (state.activeTab === 'materials') {
                    const mCard = document.createElement('div');
                    mCard.onclick = () => toggleTask(item.id);
                    mCard.className = `border rounded-3xl p-4 transition-all active:scale-95 shadow-lg ${isChecked ? 'bg-stone-800 border-transparent opacity-60' : 'bg-white border-transparent'} ${isNew ? 'animate-pop' : ''}`;
                    mCard.innerHTML = `
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-[10px] font-black uppercase text-stone-400 font-bold">${item.type}</span>
                            <span class="text-xl">${isChecked ? 'âœ…' : 'ğŸ“¦'}</span>
                        </div>
                        <p class="text-[11px] font-black leading-tight ${isChecked ? 'text-stone-200 line-through' : 'text-stone-800'} font-bold">${item.req}</p>
                    `;
                    if (!container.querySelector('.material-grid')) {
                        const mGrid = document.createElement('div');
                        mGrid.className = 'grid grid-cols-2 gap-4 material-grid';
                        list.appendChild(mGrid);
                    }
                    list.querySelector('.material-grid').appendChild(mCard);

                } else {
                    const itemDiv = document.createElement('div');
                    itemDiv.onclick = () => toggleTask(item.id);
                    itemDiv.className = `flex items-center p-5 rounded-3xl border transition-all active:scale-[0.98] shadow-xl ${isChecked ? 'bg-stone-800 border-transparent' : 'bg-white border-stone-200'} ${isNew ? 'animate-pop' : ''}`;
                    itemDiv.innerHTML = `
                        <div class="w-14 h-14 rounded-2xl flex items-center justify-center text-3xl mr-5 border-4 ${isChecked ? 'bg-stone-700 border-stone-600' : 'bg-stone-100 border-stone-200'}">
                            ${item.icon}
                        </div>
                        <div class="flex-1 ${isChecked ? 'text-stone-200 opacity-60' : ''}">
                            <h4 class="text-sm font-bold ${isChecked ? 'text-white' : 'text-stone-900'} font-bold">${item.label}</h4>
                            <p class="text-[10px] ${isChecked ? 'text-stone-300' : 'text-stone-500'} font-bold mt-1">${item.desc}</p>
                        </div>
                        <div class="w-10 h-10 rounded-xl border-4 flex items-center justify-center ${isChecked ? 'bg-orange-600 border-orange-500' : 'border-stone-200'}">
                            ${isChecked ? '<span class="text-white text-xl">âœ”</span>' : ''}
                        </div>
                    `;
                    list.appendChild(itemDiv);
                }
            });
            container.appendChild(list);
        }
    </script>
</body>
</html>